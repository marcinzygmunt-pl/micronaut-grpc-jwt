<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="640px" preserveAspectRatio="none" style="width:637px;height:640px;background:#FFFFFF;" version="1.1" viewBox="0 0 637 640" width="637px" zoomAndPan="magnify"><title>gRPC JWT Authentication &amp; Resource Access Sequence</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="378.0889" x="128.0073" y="30.1074">gRPC JWT Authentication &amp; Resource Access Sequence</text><rect fill="none" height="98.5039" style="stroke:#000000;stroke-width:1.5;" width="347.5537" x="10" y="188.8242"/><rect fill="none" height="98.5039" style="stroke:#000000;stroke-width:1.5;" width="476.5947" x="10" y="349.9102"/><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="434.0449" width="8" x="36.8965" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="40" x2="40" y1="123.2422" y2="557.2871"/></g><g><title>Auth Server</title><rect fill="#000000" fill-opacity="0.00000" height="434.0449" width="8" x="281.3125" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="285.0713" x2="285.0713" y1="123.2422" y2="557.2871"/></g><g><title>Resource Server</title><rect fill="#000000" fill-opacity="0.00000" height="434.0449" width="8" x="413.0742" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="416.5537" x2="416.5537" y1="123.2422" y2="557.2871"/></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.793" x="20" y="119.7285">Client</text><ellipse cx="40.8965" cy="53.1211" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M40.8965,61.1211 L40.8965,88.1211 M27.8965,69.1211 L53.8965,69.1211 M40.8965,88.1211 L27.8965,103.1211 M40.8965,88.1211 L53.8965,103.1211" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.793" x="20" y="571.3945">Client</text><ellipse cx="40.8965" cy="583.4082" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M40.8965,591.4082 L40.8965,618.4082 M27.8965,599.4082 L53.8965,599.4082 M40.8965,618.4082 L27.8965,633.4082 M40.8965,618.4082 L53.8965,633.4082" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Auth"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.4824" x="223.0713" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.9238" x="248.3506" y="93.1074">Auth Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.4824" x="230.0713" y="111.7285">(Identity Provider)</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.4824" x="223.0713" y="556.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.9238" x="248.3506" y="578.3945">Auth Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.4824" x="230.0713" y="597.0156">(Identity Provider)</text></g><g class="participant participant-head" data-participant="Resource"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119.041" x="357.5537" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.041" x="364.5537" y="93.1074">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.8896" x="401.1294" y="111.7285">(API)</text></g><g class="participant participant-tail" data-participant="Resource"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119.041" x="357.5537" y="556.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.041" x="364.5537" y="578.3945">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.8896" x="401.1294" y="597.0156">(API)</text></g><g class="message" data-participant-1="Client" data-participant-2="Auth"><polygon fill="#181818" points="273.3125,169.8242,283.3125,173.8242,273.3125,177.8242,277.3125,173.8242" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="40.8965" x2="279.3125" y1="173.8242" y2="173.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.7998" x="47.8965" y="151.2705">gRPC AuthService/Login</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.416" x="47.8965" y="168.5615">LoginRequest { username, password }</text></g><path d="M10,188.8242 L70.1709,188.8242 L70.1709,198.1152 L60.1709,208.1152 L10,208.1152 L10,188.8242" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="98.5039" style="stroke:#000000;stroke-width:1.5;" width="347.5537" x="10" y="188.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="25" y="203.8525">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="93.5322" x="85.1709" y="202.6943">[credentials valid]</text><g class="message" data-participant-1="Auth" data-participant-2="Client"><polygon fill="#181818" points="51.8965,227.4063,41.8965,231.4063,51.8965,235.4063,47.8965,231.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="45.8965" x2="284.3125" y1="231.4063" y2="231.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.3462" x="57.8965" y="226.1436">LoginReply { token (JWT) }</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="357.5537" y1="240.4063" y2="240.4063"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="103.3076" x="15" y="252.2764">[credentials invalid]</text><g class="message" data-participant-1="Auth" data-participant-2="Client"><polygon fill="#181818" points="51.8965,275.3281,41.8965,279.3281,51.8965,283.3281,47.8965,279.3281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="45.8965" x2="284.3125" y1="279.3281" y2="279.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.3271" x="57.8965" y="274.0654">Unauthorized</text></g><g class="message" data-participant-1="Client" data-participant-2="Resource"><polygon fill="#181818" points="405.0742,330.9102,415.0742,334.9102,405.0742,338.9102,409.0742,334.9102" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="40.8965" x2="411.0742" y1="334.9102" y2="334.9102"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211.7007" x="47.8965" y="312.3564">gRPC ResourceService/SecureHello</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.7197" x="47.8965" y="329.6475">Authorization: Bearer &lt;token&gt;</text></g><path d="M10,349.9102 L70.1709,349.9102 L70.1709,359.2012 L60.1709,369.2012 L10,369.2012 L10,349.9102" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="98.5039" style="stroke:#000000;stroke-width:1.5;" width="476.5947" x="10" y="349.9102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="25" y="364.9385">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="107.6099" x="85.1709" y="363.7803">[access_token valid]</text><g class="message" data-participant-1="Resource" data-participant-2="Client"><polygon fill="#181818" points="51.8965,388.4922,41.8965,392.4922,51.8965,396.4922,47.8965,392.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="45.8965" x2="416.0742" y1="392.4922" y2="392.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.686" x="57.8965" y="387.2295">SecureHelloReply { protected data }</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="486.5947" y1="401.4922" y2="401.4922"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="173.626" x="15" y="413.3623">[access_token expired or invalid]</text><g class="message" data-participant-1="Resource" data-participant-2="Client"><polygon fill="#181818" points="51.8965,436.4141,41.8965,440.4141,51.8965,444.4141,47.8965,440.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="45.8965" x2="416.0742" y1="440.4141" y2="440.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.3271" x="57.8965" y="435.1514">Unauthorized</text></g><path d="M20,460.4141 L20,487.4141 L280,487.4141 L280,470.4141 L270,460.4141 L20,460.4141" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M270,460.4141 L270,470.4141 L280,470.4141 L270,460.4141" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.1479" x="26" y="479.4424">Signs JWT access_token with private key</text><path d="M422,497.7051 L422,541.7051 L630,541.7051 L630,507.7051 L620,497.7051 L422,497.7051" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M620,497.7051 L620,507.7051 L630,507.7051 L620,497.7051" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.4917" x="428" y="516.7334">Verifies JWT signature &amp; claims</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.4453" x="428" y="534.0244">using public key / JWKS</text><!--SRC=[VPBDRzD04CNl-rSyzO1QYQht25KAlL3W42LyN2AXOJrnHztkcjbrIa3yxupNiKa4mXT_pVpUUxDJf0H6krxTuUtd3rZsvO5Z4Kz5KiGBh3cdNZrZwJtdZ0r_wpbwTevyIOgx85RlEb9haevYmSK0iKBTisxZvNqp0Ci1AqrxQLYlBa2vAfstpL9pwt9rFnPFlvmRzN1zMm6BqVdmE3I9vvltgPMuZVMs7ipcWf_eCska9tw9Zd9-JjhWbwDGu9MhFmePUmhIEDXL4roRo2Ytm17NXOF1IdhaY4kRrvLHE6G-mqZy3-XZ9FkKL7vmupWsxZJI5FCOQtgTectOzyflE8IqZSiZfXxK0g-Pb1MlghVR6etgYNqPtVwnD8_vrDO9UahPQIhi2pTegD0Kz0pAtpknuB0zE0tzJuM_WqVZ8_2k8Et6TG0sqiPSD_5Cw5biZ9tAdgpbaGy304F_aQBIFbJCl2Z09rRP2O-qR5mg5j5MsWUIfmmhwRF45bt_DOWViBYnudURcVuR]--></g></svg>